<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 8.1.1">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.0/css/all.min.css" integrity="sha256-VHqXKFhhMxcpubYf9xiWdCiojEbY9NexQ4jh8AxbvcM=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/blue/pace-theme-minimal.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous" defer></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"cartery.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":true,"version":"8.27.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"codeblock":{"theme":{"light":"default","dark":"stackoverflow-dark"},"prism":{"light":"prism","dark":"prism-dark"},"copy_button":{"enable":true,"style":"mac"},"fold":{"enable":false,"height":500},"language":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":true,"lazyload":true,"pangu":true,"comments":{"style":"tabs","active":"giscus","storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/search.xml","localsearch":{"enable":true,"top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js" defer></script>

    <meta property="og:type" content="website">
<meta property="og:title" content="Beside Lake Baikal">
<meta property="og:url" content="https://cartery.github.io/index.html">
<meta property="og:site_name" content="Beside Lake Baikal">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="cartery">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://cartery.github.io/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"en","comments":"","permalink":"","path":"index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Beside Lake Baikal</title>
  








  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/next-theme-pjax/0.6.0/pjax.min.js" integrity="sha256-vxLn1tSKWD4dqbMRyv940UYw4sXgMtYcK6reefzZrao=" crossorigin="anonymous" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/medium-zoom/1.1.0/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lozad.js/1.16.0/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pangu/7.2.0/pangu.umd.js" integrity="sha256-JnmRRnJK7DC6RQJbAJb6AXOM9OmWzS6z8eYultk/48Y=" crossorigin="anonymous" defer></script>
<script src="/js/utils.js" defer></script><script src="/js/motion.js" defer></script><script src="/js/sidebar.js" defer></script><script src="/js/next-boot.js" defer></script><script src="/js/pjax.js" defer></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.5.0/search.js" integrity="sha256-xFC6PJ82SL9b3WkGjFavNiA9gm5z6UBxWPiu4CYjptg=" crossorigin="anonymous" defer></script>
<script src="/js/third-party/search/local-search.js" defer></script>


  <script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"default","dark":"dark"},"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mermaid/11.10.1/mermaid.min.js","integrity":"sha256-BmQmdWDS8X2OTbrwELWK366LV6escyWhHHe0XCTU/Hk="}}</script>
  <script src="/js/third-party/tags/mermaid.js" defer></script>



  <script src="/js/third-party/pace.js" defer></script>


  
  <script data-pjax async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




  

  <script class="next-config" data-name="enableMath" type="application/json">false</script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css" integrity="sha256-UF1fgpAiu3tPJN/uCqEUHNe7pnr+QR0SQDNfgglgtcM=" crossorigin="anonymous">
  <script class="next-config" data-name="katex" type="application/json">{"copy_tex_js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/contrib/copy-tex.min.js","integrity":"sha256-Us54+rSGDSTvIhKKUs4kygE2ipA0RXpWWh0/zLqw3bs="}}</script>
  <script src="/js/third-party/math/katex.js" defer></script>


  <script src="https://cdnjs.cloudflare.com/ajax/libs/quicklink/3.0.1/quicklink.umd.js" integrity="sha256-44BednzIpUeQJcY8qtLyarFu0UCCTbgmWOvaoehiFQQ=" crossorigin="anonymous" defer></script>
  <script class="next-config" data-name="quicklink" type="application/json">{"enable":true,"home":true,"archive":true,"delay":true,"timeout":3000,"priority":true,"url":"https://cartery.github.io/"}</script>
  <script src="/js/third-party/quicklink.js" defer></script>

  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Beside Lake Baikal</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
      <div class="search-header">
        <span class="search-icon">
          <i class="fa fa-search"></i>
        </span>
        <div class="search-input-container">
          <input autocomplete="off" autocapitalize="off" maxlength="80"
                placeholder="Searching..." spellcheck="false"
                type="search" class="search-input">
        </div>
        <span class="popup-btn-close" role="button">
          <i class="fa fa-times-circle"></i>
        </span>
      </div>
      <div class="search-result-container">
        <div class="search-result-icon">
          <i class="fa fa-spinner fa-pulse fa-5x"></i>
        </div>
      </div>
    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">cartery</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">1</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">3</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">3</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://cartery.github.io/2025/01/30/2025-01-30-python-recursive-character-text-splitter/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="cartery">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Beside Lake Baikal">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | Beside Lake Baikal">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/01/30/2025-01-30-python-recursive-character-text-splitter/" class="post-title-link" itemprop="url">Python RecursiveCharacterTextSplitter 源码解读</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2025-01-30 00:00:00" itemprop="dateCreated datePublished" datetime="2025-01-30T00:00:00+00:00">2025-01-30</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2026-02-03 06:53:05" itemprop="dateModified" datetime="2026-02-03T06:53:05+00:00">2026-02-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/agent/" itemprop="url" rel="index"><span itemprop="name">agent</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/agent/%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB/" itemprop="url" rel="index"><span itemprop="name">源码解读</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/agent/%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB/textSplitter/" itemprop="url" rel="index"><span itemprop="name">textSplitter</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="Word count in article">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">Word count in article: </span>
      <span>1.1k</span>
    </span>
    <span class="post-meta-item" title="Reading time">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">Reading time &asymp;</span>
      <span>4 mins.</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="python-recursivecharactertextsplitter-源码解读"><a class="markdownIt-Anchor" href="#python-recursivecharactertextsplitter-源码解读"></a> Python RecursiveCharacterTextSplitter 源码解读</h1>
<h2 id="概述"><a class="markdownIt-Anchor" href="#概述"></a> 概述</h2>
<p><code>RecursiveCharacterTextSplitter</code> 是 LangChain Python 中<strong>推荐的通用文本分割器</strong>。它按<strong>分隔符优先级</strong>递归切分文本，尽量保持段落、句子、词语的完整性，直到每个块满足 <code>chunk_size</code> 限制。</p>
<ul>
<li>官方 API：<a target="_blank" rel="noopener" href="https://python.langchain.com/api_reference/text_splitters/character/langchain_text_splitters.character.RecursiveCharacterTextSplitter.html">RecursiveCharacterTextSplitter</a></li>
</ul>
<h2 id="默认分隔符顺序"><a class="markdownIt-Anchor" href="#默认分隔符顺序"></a> 默认分隔符顺序</h2>
<p>按优先级依次尝试，直到切出的块不超过 <code>chunk_size</code>：</p>
<table>
<thead>
<tr>
<th>优先级</th>
<th>分隔符</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td><code>"\n\n"</code></td>
<td>段落</td>
</tr>
<tr>
<td>2</td>
<td><code>"\n"</code></td>
<td>行</td>
</tr>
<tr>
<td>3</td>
<td><code>" "</code></td>
<td>空格（词）</td>
</tr>
<tr>
<td>4</td>
<td><code>""</code></td>
<td>字符（兜底）</td>
</tr>
</tbody>
</table>
<p>即：先按段落切，超长再按行，再按空格，最后才按字符切。</p>
<h2 id="核心参数"><a class="markdownIt-Anchor" href="#核心参数"></a> 核心参数</h2>
<table>
<thead>
<tr>
<th>参数</th>
<th>类型</th>
<th>默认值</th>
<th>说明</th>
<th>来源</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>chunk_size</code></td>
<td>int</td>
<td>1000</td>
<td>每个块的目标长度（字符数或 token 数）</td>
<td><strong>继承 TextSplitter</strong></td>
</tr>
<tr>
<td><code>chunk_overlap</code></td>
<td>int</td>
<td>200</td>
<td>相邻块之间的重叠长度</td>
<td><strong>继承 TextSplitter</strong></td>
</tr>
<tr>
<td><code>length_function</code></td>
<td>Callable</td>
<td><code>len</code></td>
<td>计算长度的方式（字符数或 token 数）</td>
<td><strong>继承 TextSplitter</strong></td>
</tr>
<tr>
<td><code>separators</code></td>
<td>List[str]</td>
<td><code>["\n\n", "\n", " ", ""]</code></td>
<td>分隔符列表，按顺序使用</td>
<td>本类 / CharacterTextSplitter</td>
</tr>
<tr>
<td><code>keep_separator</code></td>
<td>bool</td>
<td>True</td>
<td>是否在切分后的文本中保留分隔符</td>
<td>本类 / CharacterTextSplitter</td>
</tr>
<tr>
<td><code>is_separator_regex</code></td>
<td>bool</td>
<td>False</td>
<td>分隔符是否按正则解析</td>
<td>本类 / CharacterTextSplitter</td>
</tr>
</tbody>
</table>
<p><strong>继承自 TextSplitter 的参数</strong>：<code>chunk_size</code>、<code>chunk_overlap</code>、<code>length_function</code>（基类定义块大小、重叠与长度计算方式；本类在此基础上增加 <code>separators</code>、<code>keep_separator</code>、<code>is_separator_regex</code> 等与分隔符相关的配置）。</p>
<h2 id="源码解读"><a class="markdownIt-Anchor" href="#源码解读"></a> 源码解读</h2>
<p>LangChain Python 的 <code>RecursiveCharacterTextSplitter</code> 继承自 <code>TextSplitter</code>，核心逻辑在<strong>递归按分隔符切分</strong>和<strong>带重叠的合并</strong>两处。</p>
<h3 id="1-递归切分_split_text"><a class="markdownIt-Anchor" href="#1-递归切分_split_text"></a> 1. 递归切分：<code>_split_text</code></h3>
<p>按「当前分隔符」把文本拆成若干段；若某段仍超过 <code>chunk_size</code>，则用「下一个更细的分隔符」对该段递归切分。</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">_split_text</span>(<span class="params">self, text: <span class="built_in">str</span>, separators: <span class="type">List</span>[<span class="built_in">str</span>]</span>) -&gt; <span class="type">List</span>[<span class="built_in">str</span>]:</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> text:</span><br><span class="line">        <span class="keyword">return</span> []</span><br><span class="line">    <span class="comment"># 无更多分隔符时，按字符兜底</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> separators:</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>._merge_splits(<span class="built_in">list</span>(text), <span class="string">""</span>)</span><br><span class="line"></span><br><span class="line">    sep = separators[<span class="number">0</span>]                    <span class="comment"># 当前分隔符（如 "\n\n"）</span></span><br><span class="line">    rest_separators = separators[<span class="number">1</span>:]       <span class="comment"># 更细的分隔符（如 "\n", " ", ""）</span></span><br><span class="line">    splits = <span class="variable language_">self</span>._split_on_separator(text, sep)  <span class="comment"># 按 sep 切分</span></span><br><span class="line"></span><br><span class="line">    good_splits = []</span><br><span class="line">    <span class="keyword">for</span> s <span class="keyword">in</span> splits:</span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>._length_function(s) &lt;= <span class="variable language_">self</span>._chunk_size:</span><br><span class="line">            good_splits.append(s)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">if</span> good_splits:</span><br><span class="line">                <span class="keyword">yield</span> <span class="keyword">from</span> <span class="variable language_">self</span>._merge_splits(good_splits, sep)</span><br><span class="line">                good_splits = []</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> rest_separators:</span><br><span class="line">                <span class="keyword">yield</span> <span class="keyword">from</span> <span class="variable language_">self</span>._merge_splits([s], sep)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">yield</span> <span class="keyword">from</span> <span class="variable language_">self</span>._split_text(s, rest_separators)  <span class="comment"># 递归</span></span><br><span class="line">    <span class="keyword">if</span> good_splits:</span><br><span class="line">        <span class="keyword">yield</span> <span class="keyword">from</span> <span class="variable language_">self</span>._merge_splits(good_splits, sep)</span><br></pre></td></tr></tbody></table></figure>
<p>要点：</p>
<ul>
<li>用 <code>_split_on_separator(text, sep)</code> 得到当前层的 <code>splits</code>。</li>
<li>长度 ≤ <code>chunk_size</code> 的进入 <code>good_splits</code>，凑一批后 <code>_merge_splits</code> 合并并产出。</li>
<li>长度 &gt; <code>chunk_size</code> 的：若还有 <code>rest_separators</code> 则递归 <code>_split_text(s, rest_separators)</code>；否则按当前层合并或按字符兜底。</li>
</ul>
<h3 id="2-合并与重叠_merge_splits"><a class="markdownIt-Anchor" href="#2-合并与重叠_merge_splits"></a> 2. 合并与重叠：<code>_merge_splits</code></h3>
<p>将一批小片段合并成若干块，每块长度约 <code>chunk_size</code>，相邻块之间重叠 <code>chunk_overlap</code>。</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">_merge_splits</span>(<span class="params">self, splits: <span class="type">List</span>[<span class="built_in">str</span>], separator: <span class="built_in">str</span></span>) -&gt; <span class="type">List</span>[<span class="built_in">str</span>]:</span><br><span class="line">    docs = []</span><br><span class="line">    current = []</span><br><span class="line">    total_len = <span class="number">0</span></span><br><span class="line">    sep_len = <span class="variable language_">self</span>._length_function(separator)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> s <span class="keyword">in</span> splits:</span><br><span class="line">        n = <span class="variable language_">self</span>._length_function(s) + (sep_len <span class="keyword">if</span> current <span class="keyword">else</span> <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">if</span> total_len + n &gt; <span class="variable language_">self</span>._chunk_size <span class="keyword">and</span> current:</span><br><span class="line">            doc = <span class="variable language_">self</span>._join_docs(current, separator)</span><br><span class="line">            docs.append(doc)</span><br><span class="line">            <span class="comment"># 重叠：从队头丢弃片段，使剩余长度约等于 chunk_overlap</span></span><br><span class="line">            <span class="keyword">while</span> current <span class="keyword">and</span> (total_len &gt; <span class="variable language_">self</span>._chunk_overlap <span class="keyword">or</span> total_len + n &gt; <span class="variable language_">self</span>._chunk_size):</span><br><span class="line">                total_len -= <span class="variable language_">self</span>._length_function(current[<span class="number">0</span>]) + (sep_len <span class="keyword">if</span> <span class="built_in">len</span>(current) &gt; <span class="number">1</span> <span class="keyword">else</span> <span class="number">0</span>)</span><br><span class="line">                current = current[<span class="number">1</span>:]</span><br><span class="line">            total_len = <span class="built_in">sum</span>(<span class="variable language_">self</span>._length_function(x) <span class="keyword">for</span> x <span class="keyword">in</span> current) + sep_len * (<span class="built_in">len</span>(current) - <span class="number">1</span>)</span><br><span class="line">        current.append(s)</span><br><span class="line">        total_len += n</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> current:</span><br><span class="line">        docs.append(<span class="variable language_">self</span>._join_docs(current, separator))</span><br><span class="line">    <span class="keyword">return</span> docs</span><br></pre></td></tr></tbody></table></figure>
<p>要点：</p>
<ul>
<li>顺序遍历 <code>splits</code>，累加长度；超过 <code>chunk_size</code> 时先产出当前块，再根据 <code>chunk_overlap</code> 从队头丢弃片段，实现块间重叠。</li>
<li><code>_join_docs</code> 用 <code>separator</code> 把列表拼成最终字符串。</li>
</ul>
<h3 id="3-调用链"><a class="markdownIt-Anchor" href="#3-调用链"></a> 3. 调用链</h3>
<table>
<thead>
<tr>
<th>入口方法</th>
<th>内部调用</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>split_text(text)</code></td>
<td><code>_split_text(text, self.separators)</code>，得到递归 + 合并后的块列表</td>
</tr>
<tr>
<td><code>split_documents(documents)</code></td>
<td>对每个 document 的 <code>page_content</code> 调 <code>split_text</code>，再按索引挂回 metadata</td>
</tr>
<tr>
<td><code>create_documents(texts, metadatas)</code></td>
<td>对每个 <code>text</code> 调 <code>split_text</code>，用 <code>metadatas</code> 构造 Document</td>
</tr>
</tbody>
</table>
<h2 id="常用方法"><a class="markdownIt-Anchor" href="#常用方法"></a> 常用方法</h2>
<table>
<thead>
<tr>
<th>方法</th>
<th>说明</th>
<th>来源</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>split_text(text: str) -&gt; List[str]</code></td>
<td>对单个字符串切分，返回字符串列表</td>
<td><strong>继承 TextSplitter</strong>（本类重写内部逻辑，仍调 <code>_split_text</code>）</td>
</tr>
<tr>
<td><code>create_documents(texts: List[str], metadatas=None)</code></td>
<td>从字符串列表创建 Document 列表</td>
<td><strong>继承 TextSplitter</strong></td>
</tr>
<tr>
<td><code>split_documents(documents: List[Document]) -&gt; List[Document]</code></td>
<td>对 Document 列表切分，保留元数据</td>
<td><strong>继承 TextSplitter</strong></td>
</tr>
<tr>
<td><code>transform_documents(documents: List[Document]) -&gt; List[Document]</code></td>
<td>与 <code>split_documents</code> 等价，用于管道</td>
<td><strong>继承 TextSplitter</strong></td>
</tr>
<tr>
<td><code>from_tiktoken_encoder(...)</code></td>
<td>类方法，按 tiktoken 的 token 数切分</td>
<td>本类 / CharacterTextSplitter</td>
</tr>
<tr>
<td><code>from_huggingface_tokenizer(...)</code></td>
<td>类方法，按 HuggingFace tokenizer 切分</td>
<td>本类 / CharacterTextSplitter</td>
</tr>
<tr>
<td><code>from_language(language, ...)</code></td>
<td>类方法，按编程语言预设分隔符</td>
<td>本类 / CharacterTextSplitter</td>
</tr>
</tbody>
</table>
<p><strong>继承自 TextSplitter 的方法</strong>：<code>split_text</code>、<code>create_documents</code>、<code>split_documents</code>、<code>transform_documents</code>（基类定义接口与默认实现，本类通过重写 <code>_split_text</code> 等改变切分行为）。</p>
<h2 id="算法要点"><a class="markdownIt-Anchor" href="#算法要点"></a> 算法要点</h2>
<ol>
<li><strong>递归</strong>：用当前分隔符切分；若有片段长度仍大于 <code>chunk_size</code>，则用下一个分隔符对该片段递归切分。</li>
<li><strong>重叠</strong>：相邻块之间保留 <code>chunk_overlap</code> 个字符（或 token），避免语义在边界处断裂。</li>
<li><strong>长度计算</strong>：默认用 <code>len()</code>（字符数）；通过 <code>length_function</code> 可改为 token 数（如 tiktoken）。</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>





</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2026</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">cartery</span>
  </div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
    <span title="Word count total">1k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="Reading time total">4 mins.</span>
  </span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="Total Visitors">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="Total Views">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>

</body>
</html>
